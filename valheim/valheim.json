{
  "type": "valheim",
  "display": "Valheim Dedicated Server",
  "data": {
    "modpack": {
      "type": "string",
      "value": "",
      "display": "Modpack to run with",
      "desc": "Open https://valheim.thunderstore.io/package/denikson/BepInExPack_Valheim/ in new tab and right 'manual download' click > copy link. Paste it here if you wish to use this modpack.",
      "required": false,
      "userEdit": true
    },
    "name": {
      "type": "string",
      "value": "Valheim Server",
      "display": "Name",
      "desc": "Choose your servername.",
      "required": true,
      "userEdit": true
    },
    "password": {
      "type": "string",
      "value": "valheim",
      "display": "Password",
      "desc": "Set the server password.",
      "required": true,
      "userEdit": true
    },
    "port": {
      "type": "integer",
      "value": 2456,
      "display": "Port",
      "desc": "What port to bind the server to.",
      "required": true,
      "userEdit": false
    },
    "world": {
      "type": "string",
      "value": "VHWorld",
      "display": "World",
      "desc": "What worldmap name to use.",
      "required": true,
      "userEdit": true
    }
  },
  "install": [
    {
      "if": "env == 'host'",
      "type": "steamgamedl",
      "appId": "896660"
    },
    {
      "if": "env == 'docker'",
      "type": "command",
      "commands": [
        "steamcmd +force_install_dir /pufferpanel +login anonymous +app_update 896660 +quit"
      ]
    },
    {
      "if": "modpack != ''",
      "type": "download",
      "files": [
        "${modpack}"
      ]
    },
    {
      "if": "modpack != ''",
      "type": "command",
      "commands": [
        "unzip ./denikson-BepInExPack_Valheim*.zip -d ./bepin_temp/",
        "cp -r ./bepin_temp/BepInExPack_Valheim/. ./",
        "rm -r ./bepin_temp"
      ]
    },
    {
      "type": "command",
      "commands": [
        "chmod +x valheim_server.x86_64"
      ]
    }
  ],
  "run": {
    "command": "./valheim_server.x86_64 -name ${name} -port ${port} -world ${world} -password ${password} -public 1 > /dev/null &",
    "stopCode": 2,
    "environmentVars": {
      "LD_LIBRARY_PATH": "./linux64:$LD_LIBRARY_PATH"
    },
    "stdin": {
      "type": "stdin"
    },
    "autostart": false,
    "autorecover": false,
    "autorestart": false
  },
  "environment": {
    "type": "host"
  },
  "supportedEnvironments": [
    {
      "type": "host"
    },
    {
      "type": "docker",
      "image": "steamcmd/steamcmd",
      "portBindings": [
        "${port}:${port}/tcp"
      ]
    }
  ],
  "requirements": {
    "os": "linux",
    "arch": "amd64",
    "binaries": [
      "unzip"
    ]
  }
}